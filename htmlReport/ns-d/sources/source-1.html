


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1250"> 
  <title>Coverage Report > UserActivity</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.kamjer.woda.activity.useractivity</a>
</div>

<h1>Coverage Summary for Class: UserActivity (com.kamjer.woda.activity.useractivity)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">UserActivity</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/72)
  </span>
</td>
</tr>
  <tr>
    <td class="name">UserActivity$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/73)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.kamjer.woda.activity.useractivity;
&nbsp;
&nbsp;import android.app.Activity;
&nbsp;import android.content.Intent;
&nbsp;import android.graphics.Color;
&nbsp;import android.os.Bundle;
&nbsp;import android.view.View;
&nbsp;import android.widget.EditText;
&nbsp;import android.widget.ImageButton;
&nbsp;
&nbsp;import androidx.activity.result.ActivityResultLauncher;
&nbsp;import androidx.activity.result.contract.ActivityResultContracts;
&nbsp;import androidx.annotation.Nullable;
&nbsp;import androidx.appcompat.app.AppCompatActivity;
&nbsp;import androidx.lifecycle.ViewModelProvider;
&nbsp;import androidx.recyclerview.widget.LinearLayoutManager;
&nbsp;import androidx.recyclerview.widget.RecyclerView;
&nbsp;
&nbsp;import com.google.android.material.floatingactionbutton.FloatingActionButton;
&nbsp;import com.kamjer.woda.R;
&nbsp;import com.kamjer.woda.activity.useractivity.coloreditdialog.ColorPickerDialog;
&nbsp;import com.kamjer.woda.activity.useractivity.coloreditdialog.ColorSelectorAction;
&nbsp;import com.kamjer.woda.activity.useractivity.deletetypeconflictdialog.DeleteTypeConflictDialog;
&nbsp;import com.kamjer.woda.activity.useractivity.typeView.TypeListViewAdapter;
&nbsp;import com.kamjer.woda.activity.useractivity.typeView.TypeNameChangedAction;
&nbsp;import com.kamjer.woda.activity.useractivity.typeView.TypeRecyclerView;
&nbsp;import com.kamjer.woda.model.Type;
&nbsp;import com.kamjer.woda.model.Water;
&nbsp;import com.kamjer.woda.viewmodel.UserViewModel;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.Optional;
&nbsp;
<b class="nc">&nbsp;public class UserActivity extends AppCompatActivity {</b>
&nbsp;
&nbsp;    private EditText textViewWaterAmount;
&nbsp;    private UserViewModel userViewModel;
&nbsp;
&nbsp;    private TypeListViewAdapter adapter;
&nbsp;
&nbsp;    private ColorSelectorAction colorSelectorAction;
&nbsp;    private ColorSelectorAction buttonRemoveTypeAction;
&nbsp;
&nbsp;    private TypeNameChangedAction typeNameChangedAction;
&nbsp;
&nbsp;    private TypeRecyclerView typeListRecycler;
&nbsp;    @Override
&nbsp;    protected void onCreate(@Nullable Bundle savedInstanceState) {
<b class="nc">&nbsp;        super.onCreate(savedInstanceState);</b>
&nbsp;
<b class="nc">&nbsp;        userViewModel = new ViewModelProvider(this, ViewModelProvider.Factory.from(UserViewModel.initializer)).get(UserViewModel.class);</b>
&nbsp;
<b class="nc">&nbsp;        ActivityResultLauncher&lt;Intent&gt; removeTypeConflictDialogLauncher = registerForActivityResult(new ActivityResultContracts.StartActivityForResult(),</b>
&nbsp;                result -&gt; {
<b class="nc">&nbsp;                    if (result.getResultCode() == Activity.RESULT_OK) {</b>
<b class="nc">&nbsp;                        Intent data = result.getData();</b>
<b class="nc">&nbsp;                        if (data != null) {</b>
&nbsp;//                            getting data from dialog
<b class="nc">&nbsp;                            DeleteTypeConflictDialog.Selected selected = Optional</b>
<b class="nc">&nbsp;                                    .ofNullable((DeleteTypeConflictDialog.Selected) data.getSerializableExtra(DeleteTypeConflictDialog.ACTION_SELECTED_NAME))</b>
<b class="nc">&nbsp;                                    .orElse(DeleteTypeConflictDialog.Selected.NOTHING);</b>
<b class="nc">&nbsp;                            Type typeToDelete = (Type) Optional.ofNullable(data.getSerializableExtra(DeleteTypeConflictDialog.TYPE_TO_DELETE_NAME)).orElse(new Type());</b>
<b class="nc">&nbsp;                            List&lt;Water&gt; waterList =  Optional.ofNullable((ArrayList&lt;Water&gt;) data.getSerializableExtra(DeleteTypeConflictDialog.WATER_LIST_NAME))</b>
<b class="nc">&nbsp;                                    .orElse(new ArrayList&lt;&gt;());</b>
&nbsp;//                            handling selection
<b class="nc">&nbsp;                            switch (selected) {</b>
&nbsp;                                case CHANGE:
<b class="nc">&nbsp;                                    Type typeSelected = Optional.ofNullable((Type) data.getSerializableExtra(DeleteTypeConflictDialog.TYPE_SELECTED_NAME)).orElse(new Type());</b>
<b class="nc">&nbsp;                                    changeTypesDialogAction(typeSelected, waterList, typeToDelete);</b>
<b class="nc">&nbsp;                                    break;</b>
&nbsp;                                case DELETE:
<b class="nc">&nbsp;                                    deleteTypesDialogAction(waterList, typeToDelete);</b>
&nbsp;                                    break;
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                });
&nbsp;
<b class="nc">&nbsp;        buttonRemoveTypeAction = (type, position) -&gt; userViewModel.loadWatersByType(type, this, waters -&gt; {</b>
<b class="nc">&nbsp;            ArrayList&lt;Water&gt; waterList = new ArrayList&lt;&gt;(waters);</b>
&nbsp;
&nbsp;//                if there are no waters with this type delete that type
<b class="nc">&nbsp;            if (waters.isEmpty()) {</b>
<b class="nc">&nbsp;                userViewModel.removeType(type);</b>
&nbsp;//                    if there are waters with this type ask user what to do
&nbsp;            } else {
<b class="nc">&nbsp;                Intent deleteTypeConflictDialogIntent = new Intent(this, DeleteTypeConflictDialog.class);</b>
<b class="nc">&nbsp;                deleteTypeConflictDialogIntent.putExtra(DeleteTypeConflictDialog.TYPE_LIST_NAME, new ArrayList&lt;&gt;(userViewModel.getTypes().values()));</b>
<b class="nc">&nbsp;                deleteTypeConflictDialogIntent.putExtra(DeleteTypeConflictDialog.WATER_LIST_NAME, waterList);</b>
<b class="nc">&nbsp;                deleteTypeConflictDialogIntent.putExtra(DeleteTypeConflictDialog.TYPE_TO_DELETE_NAME, type);</b>
<b class="nc">&nbsp;                removeTypeConflictDialogLauncher.launch(deleteTypeConflictDialogIntent);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
&nbsp;//        dialog for choosing new color
<b class="nc">&nbsp;        ActivityResultLauncher&lt;Intent&gt; colorEditStartYourDialogLauncher = registerForActivityResult(new ActivityResultContracts.StartActivityForResult(),</b>
&nbsp;                result -&gt; {
<b class="nc">&nbsp;                    if (result.getResultCode() == Activity.RESULT_OK) {</b>
<b class="nc">&nbsp;                        Intent data = result.getData();</b>
<b class="nc">&nbsp;                        if (data != null) {</b>
<b class="nc">&nbsp;                            Type typeToUpdate = Optional.ofNullable((Type) data.getSerializableExtra(&quot;type&quot;))</b>
<b class="nc">&nbsp;                                    .orElse(new Type());</b>
<b class="nc">&nbsp;                            userViewModel.updateType(typeToUpdate);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                });
&nbsp;
<b class="nc">&nbsp;        colorSelectorAction = (type, position) -&gt; {</b>
<b class="nc">&nbsp;            Intent colorPickerDialog = new Intent(this, ColorPickerDialog.class);</b>
<b class="nc">&nbsp;            colorPickerDialog.putExtra(&quot;type&quot;, type);</b>
<b class="nc">&nbsp;            colorEditStartYourDialogLauncher.launch(colorPickerDialog);</b>
&nbsp;        };
&nbsp;
<b class="nc">&nbsp;        typeNameChangedAction = (type, newName) -&gt; {</b>
<b class="nc">&nbsp;            type.setType(newName.toString());</b>
<b class="nc">&nbsp;            userViewModel.updateType(type);</b>
&nbsp;        };
&nbsp;
<b class="nc">&nbsp;        userViewModel.setTypesObserver(this, longTypeHashMap -&gt;</b>
<b class="nc">&nbsp;                adapter.setTypeList(new ArrayList&lt;&gt;(userViewModel.getTypes().values())));</b>
&nbsp;
<b class="nc">&nbsp;        userViewModel.setWaterAmountToDrinkObserver(this, integer -&gt; {</b>
<b class="nc">&nbsp;            textViewWaterAmount.setText(String.valueOf(userViewModel.getWaterAmountToDrink()));</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    protected void onStart() {
<b class="nc">&nbsp;        super.onStart();</b>
<b class="nc">&nbsp;        setContentView(R.layout.user_activity_layout);</b>
&nbsp;
<b class="nc">&nbsp;        ImageButton addWaterTypeButton = findViewById(R.id.imageButtonAddWaterType);</b>
<b class="nc">&nbsp;        addWaterTypeButton.setOnClickListener(v -&gt; addNewTypeAction());</b>
&nbsp;
<b class="nc">&nbsp;        textViewWaterAmount = findViewById(R.id.editTextNumber);</b>
<b class="nc">&nbsp;        textViewWaterAmount.setOnFocusChangeListener((v, hasFocus) -&gt; {</b>
<b class="nc">&nbsp;            if (!hasFocus) {</b>
<b class="nc">&nbsp;                setWaterAmountAction(v);</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        adapter = createNewTypeAdapter(new ArrayList&lt;&gt;(userViewModel.getTypes().values()));</b>
<b class="nc">&nbsp;        RecyclerView.LayoutManager layoutManager = new LinearLayoutManager(this);</b>
<b class="nc">&nbsp;        typeListRecycler = findViewById(R.id.recyclerViewTypeList);</b>
<b class="nc">&nbsp;        typeListRecycler.setLayoutManager(layoutManager);</b>
<b class="nc">&nbsp;        typeListRecycler.setAdapter(adapter);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void changeTypesDialogAction(Type typeSelected, List&lt;Water&gt; waterList, Type typeToDelete) {
<b class="nc">&nbsp;        long typeIdSelected = typeSelected.getId();</b>
<b class="nc">&nbsp;        waterList.forEach(water -&gt; water.setTypeId(typeIdSelected));</b>
<b class="nc">&nbsp;        userViewModel.insertWatersSumWatersDeleteType(waterList, typeToDelete);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void deleteTypesDialogAction(List&lt;Water&gt; waterList, Type typeToDelete) {
<b class="nc">&nbsp;        userViewModel.removeWaters(waterList);</b>
<b class="nc">&nbsp;        userViewModel.removeType(typeToDelete);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void setWaterAmountAction(View view) {
<b class="nc">&nbsp;        int waterAmountToDrink = Integer.parseInt(textViewWaterAmount.getText().toString());</b>
<b class="nc">&nbsp;        userViewModel.setWaterAmountToDrink(getApplicationContext(), waterAmountToDrink);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void addNewTypeAction() {
<b class="nc">&nbsp;        Type newType = new Type(&quot;&quot;, Color.BLACK);</b>
<b class="nc">&nbsp;        userViewModel.insertType(newType);</b>
&nbsp;    }
&nbsp;
&nbsp;    private TypeListViewAdapter createNewTypeAdapter(ArrayList&lt;Type&gt; typeList) {
<b class="nc">&nbsp;        return adapter = new TypeListViewAdapter(</b>
&nbsp;                typeList,
&nbsp;                colorSelectorAction,
&nbsp;                buttonRemoveTypeAction,
&nbsp;                typeNameChangedAction);
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    protected void onStop() {
<b class="nc">&nbsp;        super.onStop();</b>
&nbsp;//        clears focus on all elements in a recyclerView and textView, necessary to fire focus listener on ViewHolder
<b class="nc">&nbsp;        typeListRecycler.notifyFocusCleared();</b>
<b class="nc">&nbsp;        textViewWaterAmount.clearFocus();</b>
<b class="nc">&nbsp;        userViewModel.clearDisposable();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-05-18 14:11</div>
</div>
</body>
</html>
